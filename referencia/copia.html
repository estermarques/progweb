<!DOCTYPE html>
<html>
    <head>
        <title>Forever Note</title>
        <link rel="stylesheet" href="paginaDeTexto.css">
        <link href="https://fonts.googleapis.com/css?family=Lobster&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="menuPrincipal">
                <img class="logo" src="https://images.squarespace-cdn.com/content/v1/595fe4e4e3df285bcd4549f5/1504734277430-UKTKJMLZJ26RNXEP92HM/ke17ZwdGBToddI8pDm48kAf-OpKpNsh_OjjU8JOdDKBZw-zPPgdn4jUwVcJE1ZvWQUxwkmyExglNqGp0IvTJZUJFbgE-7XRK3dMEBRBhUpwkCFOLgzJj4yIx-vIIEbyWWRd0QUGL6lY_wBICnBy59Ye9GKQq6_hlXZJyaybXpCc/Groom+Service+Dogs+Regina.png?format=1000w" alt="logo">
                <span class="titulo">for(ever){note;}</span>
        </div>
        <div class="pagina">
            <div class="abaDeTextos">
                    <div class=" abaPesquisa">
                            <input type="text" class="pesquisa">
                            <button class="procurar">:mag_right:</button>
                            <button class="novoTexto">Novo</button>
                    </div>
                    <div class="abaDaSanfona">
                            <div class="listaTags tamanhoFixo" id="aba1">
                                    <span class="tag"> texto</span>
                                    <span class="tag"> codigo</span>
                                    <span class="tag"> tag</span>
    
                            </div>  
                    <button class="sanfona" id='aba1'>+</button>
                    </div>
                <div>
                    <p class='Preview' id='aba1'>Preview de um texto</p>
                </div>
                <div class="abaDaSanfona">
                        <div class="listaTags tamanhoFixo" id="aba2">
                                <span class="tag"> tag</span>
                                <span class="tag"> tag</span>
    
                        </div>
                        <button class="sanfona" id='aba2'>+</button>
                    </div>
                    
                    <div>
                        <p class='Preview' id='aba2'>Preview de um texto</p>
                    </div>

        </div>
        <div class="areaDeTexto">
            <div class='abaDaSanfona'>
                <div class="menuSecundario tamanhoFixo listaTags" id='abaPrincipal'>
                    <input class="novaTag" type="text">
                    <button onClick="inserirTag()"  class="salvarTag">✓</button>
                    <span class="tag"> texto</span>
                    <span class="tag"> codigo</span> <!--
                    --></div>
                <button class="sanfona" id='abaPrincipal'>+</button>
                <button class="botao salvarTexto" formaction="http://localhost:8080/salvarFormulario">Salvar</button>
            </div>
            <form method="POST">
                <input type="hidden" name="idUsuario" value="1234">
                <textarea class="texto" name="texto" cols="30" rows="1000">teste</textarea>
                <textarea class="tagFormulario" name="tag" style="display: hidden;"></textarea>
            </form>
        </div>
        </div>
        
    </body>
</html>


<script>

    var idDocumentoAbaPrincipal = 0
    var contagemDeAba = 2
    abrirFecharSanfona()
    trocarTextoNaCaixa()
    inserirTag()
    criarNovoTexto()
    salvarTexto()
    removerTag()
    pesquisarTag()

    function rodarJS(){
    abrirFecharSanfona()
    trocarTextoNaCaixa()
    salvarTexto()
    removerTag()
    }

    function abrirFecharSanfona(){
        document.querySelectorAll('.sanfona').forEach((botao) => {
        botao.onclick = () => {
            const idBotao = botao.id
            console.log(idBotao)
            const abaDoBotao = document.querySelector(`div#${idBotao}`)
            
            if(abaDoBotao.classList.contains('tamanhoFixo')){
                abaDoBotao.classList.remove('tamanhoFixo')
                botao.innerHTML = '-'
            }
            else{
                abaDoBotao.classList.add('tamanhoFixo')
                botao.innerHTML = '+'
            }
        }
    })
    }

   function trocarTextoNaCaixa(){
    document.querySelectorAll('.Preview').forEach((preview) => {
        preview.onclick = () => {
            const id = preview.id
            idDocumentoAbaPrincipal = id.split("aba")[1]
            const tags = document.querySelectorAll(`#${id} > span`)
            const menuSecundario = document.querySelector('.menuSecundario')
            menuSecundario.innerHTML = ""
            menuSecundario.innerHTML += `<input class="novaTag" type="text">
                    <button onClick="inserirTag()" class="salvarTag">✓</button>`
            tags.forEach((tag) => {
                menuSecundario.innerHTML += <span class="tag" style="margin-right:4px;">${tag.innerHTML}</tag>
            })

            const texto = document.querySelector('.texto')
            texto.value = document.querySelector(`p#${id}`).innerHTML
            atualizarTagsDoFormulario()
            removerTag()
        }
    })
    
   }

    function inserirTag(){
        tagParaCriar = document.querySelector('.novaTag')
        if(tagParaCriar.value != ''){
        tagMae = document.querySelector('.menuSecundario')
        tag = document.createElement("SPAN")
        tag.setAttribute('style','margin-right:4px')
        tag.classList.add('tag')
        tag.innerHTML = tagParaCriar.value
        tagParaCriar.value = ''
        tagMae.insertBefore(tag,null)
        atualizarTagsDoFormulario()
        removerTag()
        }
    }

    function criarNovoTexto(){
        document.querySelector('.novoTexto').onclick = () => {
            const menuSecundario = document.querySelector('.menuSecundario')
            menuSecundario.innerHTML = ""
            menuSecundario.innerHTML += `<input class="novaTag" type="text">
                    <button onClick="inserirTag()" class="salvarTag">✓</button>` 
            const texto = document.querySelector('.texto')
            texto.value = ''
            texto.placeholder = "Digite seu texto aqui"}
            idDocumentoAbaPrincipal = 0
            atualizarTagsDoFormulario()
            removerTag()
    }

    function salvarTexto(){
        document.querySelector('.salvarTexto').onclick = () => {
            if(idDocumentoAbaPrincipal == 0){
                let abaDaSanfona = document.createElement('DIV')
                abaDaSanfona.classList.add('abaDaSanfona')
                let listaTags = document.createElement('DIV')
                listaTags.classList.add('listaTags')
                listaTags.classList.add('tamanhoFixo')
                contagemDeAba+=1
                listaTags.id = aba${contagemDeAba}
                document.querySelectorAll('div.menuSecundario > span').forEach( (tag) => {
                listaTags.innerHTML+=`<span class="tag"> ${tag.innerHTML} </tag>`
                })
                let botao = document.createElement('BUTTON')
                botao.classList.add('sanfona')
                botao.id = aba${contagemDeAba}
                botao.innerHTML = '+'
                let preview = document.createElement('P')
                preview.classList.add('Preview')
                preview.id = aba${contagemDeAba}
                preview.innerHTML = document.querySelector('.texto').value
                console.log(preview)
                abaDeTextos = document.querySelector('.abaDeTextos')
                
                abaDaSanfona.insertBefore(listaTags,null)
                abaDaSanfona.insertBefore(botao,null)
                abaDeTextos.insertBefore(abaDaSanfona,null)
                abaDeTextos.insertBefore(preview,null)

                idDocumentoAbaPrincipal = contagemDeAba
            }
            else{
                let aba = aba${idDocumentoAbaPrincipal}
                let listaTags = document.querySelector(`div#${aba}`)
                listaTags.innerHTML = ''
                document.querySelectorAll('div.menuSecundario > span').forEach( (tag) => {
                listaTags.innerHTML+=`<span class="tag" style="margin-right:2px;"> ${tag.innerHTML} </tag>`
                })
                let preview = document.querySelector(`p#${aba}`)
                console.log(aba)
                preview.innerHTML = document.querySelector('.texto').value
            }
            rodarJS()
        }
    }

    function atualizarTagsDoFormulario(){
        const areaTags = document.querySelector('.tagFormulario')
        areaTags.value = ''
        const tags = document.querySelectorAll('div.menuSecundario > span').forEach((tag) =>{
            areaTags.value += ${tag.innerHTML};
        })
        console.log(areaTags.value)
    }

    function removerTag(){
        console.log("entrou")
        const areaTags = document.querySelector('div.menuSecundario')
        const tags = document.querySelectorAll('div.menuSecundario > span').forEach((tag) => {
            tag.onclick = () => {
                console.log("entrou")
                if(tag.classList.contains("marcado")){
                    areaTags.removeChild(tag)
                }
                else{
                    tag.classList.add('marcado')
                    setTimeout(() => {tag.classList.remove('marcado')},800)
                }
            }
        })
    }

    function pesquisarTag(){
        barraPesquisa = document.querySelector('.pesquisa').oninput = (() => {
            if(barraPesquisa.value != ''){
                listaTags = document.querySelectorAll('.listaTags not(.menuSecundario)').forEach((area) => {
                    if(!area.classList.contains('menuSecundario')){
                    const id = area.id 
                   areaMae = area.parentElement
                   preview = document.querySelector(`.Preview#${id}`)
                   console.log(id,preview)
                   previewMae = preview.parentElement
                   tags = area.childNodes
                   areaMae.style.display = 'none'
                   previewMae.style.display = 'none'
                   tags.forEach((tag) => {
                       if(tag.value == barraPesquisa.value){
                           areaMae.style.display = 'inline-block'
                           previewMae.style.display = 'block'
                       }
                   }
                   }) 
                }
            })
            else{
                listaTags = document.querySelectorAll('.listaTags').forEach((area) => {
                   const id = area.id 
                   areaMae = area.parentElement
                   preview = document.querySelector(`.Preview#${id}`)
                   previewMae = preview.parentElement
                   tags = area.childNodes
                   areaMae.style.display = 'inline-block'
                   previewMae.style.display = 'block'
                })
            }
        })
    }

</script>
